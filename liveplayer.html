<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dynamic Music Player</title>
<style>
  body { font-family: sans-serif; background: #f0f0f0; padding: 20px; }
  #player { display: flex; align-items: center; cursor: pointer; margin-bottom: 20px; }
  #coverArt { width: 100px; height: 100px; margin-right: 15px; object-fit: cover; background: #ccc; }
  .play-icon, .pause-icon { font-size: 24px; margin-left: 10px; }
  table { width: 100%; border-collapse: collapse; }
  td { padding: 5px; }
  tbody tr:hover { background: #e0e0e0; cursor: pointer; }
  td div:first-child { font-weight: bold; }
</style>
</head>
<body>

<!-- Player UI -->
<div id="player">
  <img id="coverArt" src="" alt="Cover Art">
  <div>
    <div id="songTitle">Title</div>
    <div id="artistName">Artist</div>
    <div id="releaseDate"></div>
  </div>
  <span class="play-icon">▶️</span>
  <span class="pause-icon" style="display:none;">⏸️</span>
  <a id="spotifyLink" href="#" target="_blank" style="margin-left:15px;">Open in Spotify</a>
</div>

<audio id="audioPlayer"></audio>

<!-- Tracklist table -->
<table id="tracklist">
  <tbody></tbody>
</table>

<script>
// ================= CONFIG =================
// Your tracklist: title, artist, relative time, display time
const tracksData = [
  { title: "Greatest Hits", artist: "Fleetwood Mac", relative: "6m", time: "9:38 PM" },
  { title: "Song Two", artist: "Artist B", relative: "15m", time: "9:20 PM" }
];

const tracklistTbody = document.querySelector('#tracklist tbody');
const audioPlayer = document.getElementById('audioPlayer');
const playIcon = document.querySelector('.play-icon');
const pauseIcon = document.querySelector('.pause-icon');
let isPlaying = false;

// Toggle playback
function togglePlay() {
  if (!audioPlayer.src) return;
  if (isPlaying) { audioPlayer.pause(); playIcon.style.display='inline'; pauseIcon.style.display='none'; }
  else { audioPlayer.play(); playIcon.style.display='none'; pauseIcon.style.display='inline'; }
  isPlaying = !isPlaying;
}

// Normalize title for better iTunes search
function normalizeTitle(title) {
  return title
    .replace(/\(feat[^\)]*\)/i, '') // remove (feat. ...)
    .replace(/[^\w\s]/g, '')         // remove symbols
    .trim();
}

// Fetch preview audio and artwork from iTunes API
async function fetchPreview(track) {
  const cleanTitle = normalizeTitle(track.title);
  
  let data = await fetchITunes(`${track.artist} ${cleanTitle}`);
  if(!data || data.results.length === 0) {
    data = await fetchITunes(cleanTitle); // fallback to title only
  }
  
  if(data && data.results.length > 0) {
    track.previewUrl = data.results[0].previewUrl;
    track.coverArt = data.results[0].artworkUrl100.replace('100x100','600x600');
  } else {
    track.previewUrl = '';
    track.coverArt = 'default.jpg';
  }
}

// Helper to call iTunes API
async function fetchITunes(query) {
  try {
    const res = await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(query)}&entity=song&limit=1`);
    return await res.json();
  } catch {
    return null;
  }
}

// Update player UI when a track is selected
function updatePlayer(track) {
  document.getElementById('coverArt').src = track.coverArt || 'default.jpg';
  document.getElementById('songTitle').textContent = track.title;
  document.getElementById('artistName').textContent = track.artist;
  document.getElementById('releaseDate').textContent = track.relative + ' ago';
  audioPlayer.src = track.previewUrl;
  isPlaying = false;
  playIcon.style.display='inline';
  pauseIcon.style.display='none';

  const spotifyLink = document.getElementById('spotifyLink');
  const searchQuery = encodeURIComponent(`${track.artist} ${track.title}`);
  spotifyLink.href = `https://open.spotify.com/search/${searchQuery}`;
}

// Populate the tracklist table
async function loadTracklist() {
  tracklistTbody.innerHTML = '';
  
  for(const track of tracksData){
    await fetchPreview(track);

    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${track.time}</td>
      <td>
        <div>${track.title}</div>
        <div style="opacity:0.7">${track.artist}</div>
      </td>
    `;

    row.addEventListener('click',()=>updatePlayer(track));
    tracklistTbody.appendChild(row);
  }

  // Load first track by default
  if(tracksData.length > 0) updatePlayer(tracksData[0]);
}

// Initial load
loadTracklist();

// Optional: auto-refresh every 5 minutes to update artwork/previews
setInterval(loadTracklist, 300000);

// Play/pause toggle
document.getElementById('player').addEventListener('click', togglePlay);
</script>

</body>
</html>
