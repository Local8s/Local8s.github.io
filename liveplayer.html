<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dynamic Music Player</title>
<style>
  body { font-family: sans-serif; background: #f0f0f0; padding: 20px; }
  #player { display: flex; align-items: center; cursor: pointer; margin-bottom: 20px; }
  #coverArt { width: 100px; height: 100px; margin-right: 15px; object-fit: cover; background: #ccc; }
  .play-icon, .pause-icon { font-size: 24px; margin-left: 10px; }
  table { width: 100%; border-collapse: collapse; }
  td { padding: 5px; }
  tbody tr:hover { background: #e0e0e0; cursor: pointer; }
  td div:first-child { font-weight: bold; }
</style>
</head>
<body>

<!-- Player UI -->
<div id="player">
  <img id="coverArt" src="" alt="Cover Art">
  <div>
    <div id="songTitle">Title</div>
    <div id="artistName">Artist</div>
    <div id="releaseDate"></div>
  </div>
  <span class="play-icon">▶️</span>
  <span class="pause-icon" style="display:none;">⏸️</span>
  <a id="spotifyLink" href="#" target="_blank" style="margin-left:15px;">Open in Spotify</a>
</div>

<audio id="audioPlayer"></audio>

<!-- Tracklist table -->
<table id="tracklist">
  <tbody></tbody>
</table>

<script>
// ================= CONFIG =================
// Your tracklist: only title and artist. No need to host audio/images.
const tracksData = [
  { title: "B.B. King Freestyle (feat. Drake)", artist: "Lil Wayne", relative: "6m", time: "9:38 PM" },
  { title: "Song Two", artist: "Artist B", relative: "15m", time: "9:20 PM" }
];

const tracklistTbody = document.querySelector('#tracklist tbody');
const audioPlayer = document.getElementById('audioPlayer');
const playIcon = document.querySelector('.play-icon');
const pauseIcon = document.querySelector('.pause-icon');
let isPlaying = false;

// Toggle playback
function togglePlay() {
  if (!audioPlayer.src) return;
  if (isPlaying) {
    audioPlayer.pause();
    playIcon.style.display='inline';
    pauseIcon.style.display='none';
  } else {
    audioPlayer.play();
    playIcon.style.display='none';
    pauseIcon.style.display='inline';
  }
  isPlaying = !isPlaying;
}

// Update player when a track is selected
function updatePlayer(track) {
  document.getElementById('coverArt').src = track.coverArt || 'default.jpg';
  document.getElementById('songTitle').textContent = track.title;
  document.getElementById('artistName').textContent = track.artist;
  document.getElementById('releaseDate').textContent = track.relative + ' ago';
  audioPlayer.src = track.previewUrl;
  isPlaying = false;
  playIcon.style.display='inline';
  pauseIcon.style.display='none';

  // Update Spotify link
  const spotifyLink = document.getElementById('spotifyLink');
  const searchQuery = encodeURIComponent(`${track.artist} ${track.title}`);
  spotifyLink.href = `https://open.spotify.com/search/${searchQuery}`;
}

// Fetch preview audio and artwork from iTunes API
async function fetchPreview(track) {
  try {
    const query = encodeURIComponent(`${track.artist} ${track.title}`);
    const res = await fetch(`https://itunes.apple.com/search?term=${query}&entity=song&limit=1`);
    const data = await res.json();
    if(data.results.length > 0){
      track.previewUrl = data.results[0].previewUrl;
      track.coverArt = data.results[0].artworkUrl100.replace('100x100','600x600');
    } else {
      track.previewUrl = '';
      track.coverArt = 'default.jpg';
    }
  } catch {
    track.previewUrl = '';
    track.coverArt = 'default.jpg';
  }
}

// Populate the tracklist table dynamically
async function loadTracklist() {
  tracklistTbody.innerHTML = '';
  for(const track of tracksData){
    await fetchPreview(track);

    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${track.time}</td>
      <td>
        <div>${track.title}</div>
        <div style="opacity:0.7">${track.artist}</div>
      </td>
    `;

    row.addEventListener('click',()=>updatePlayer(track));
    tracklistTbody.appendChild(row);
  }

  // Load first track by default
  if(tracksData.length > 0) updatePlayer(tracksData[0]);
}

// Initial load
loadTracklist();

// Optional: auto-refresh every 5 minutes to update artwork/previews
setInterval(loadTracklist, 300000);

// Play/pause toggle
document.getElementById('player').addEventListener('click', togglePlay);
</script>

</body>
</html>
